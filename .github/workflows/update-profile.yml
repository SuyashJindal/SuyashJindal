name: Update GitHub Profile Stats

on:
  schedule:
    - cron: '0 0 * * *' # Runs every day at midnight UTC
  workflow_dispatch: # allows manual triggering

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Fetch Starred & Repo Count
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { data: user } = await github.rest.users.getByUsername({
              username: context.repo.owner,
            });

            const stars = await github.paginate(github.rest.activity.listReposStarredByUser, {
              username: context.repo.owner,
              per_page: 100,
            });

            const repos = await github.paginate(github.rest.repos.listForUser, {
              username: context.repo.owner,
              type: "owner",
              per_page: 100,
            });

            const fs = require('fs');
            let readme = fs.readFileSync('README.md', 'utf8');

            const newContent = readme
              .replace(/‚≠ê I‚Äôve starred \*\*(\d+)\*\*/, `‚≠ê I‚Äôve starred **${stars.length}**`)
              .replace(/üõ†Ô∏è I‚Äôve created \*\*(\d+)\*\*/, `üõ†Ô∏è I‚Äôve created **${repos.length}**`);

            fs.writeFileSync('README.md', newContent);
      
      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Update starred and repo count" || echo "No changes to commit"
          git push
